syntax = "proto3";

package pricing.v1;

option go_package = "github.com/MuhibNayem/Travio/server/api/proto/pricing/v1;pricingv1";

service PricingService {
  // Calculate final price based on rules
  rpc CalculatePrice(CalculatePriceRequest) returns (CalculatePriceResponse);
  
  // Admin: Get all pricing rules
  rpc GetRules(GetRulesRequest) returns (GetRulesResponse);
  
  // Admin: Create a new pricing rule
  rpc CreateRule(CreateRuleRequest) returns (CreateRuleResponse);
  
  // Admin: Update a pricing rule
  rpc UpdateRule(UpdateRuleRequest) returns (UpdateRuleResponse);
  
  // Admin: Delete a pricing rule
  rpc DeleteRule(DeleteRuleRequest) returns (DeleteRuleResponse);
}

message CalculatePriceRequest {
  string trip_id = 1;
  string seat_class = 2;
  string date = 3;
  int32 quantity = 4;
  int64 base_price_paisa = 5;
  double occupancy_rate = 6;
  string organization_id = 7; // For operator-specific overrides
}

message CalculatePriceResponse {
  int64 final_price_paisa = 1;
  int64 base_price_paisa = 2;
  repeated AppliedRule applied_rules = 3;
}

message AppliedRule {
  string rule_id = 1;
  string rule_name = 2;
  double multiplier = 3;
}

message PricingRule {
  string id = 1;
  string organization_id = 2; // Null/Empty for Global
  string name = 3;
  string description = 4;
  string condition = 5;
  double multiplier = 6;
  int32 priority = 7;
  bool is_active = 8;
  string created_at = 9;
  string updated_at = 10;
}

message GetRulesRequest {
  bool include_inactive = 1;
  string organization_id = 2; // Filter
}

message GetRulesResponse {
  repeated PricingRule rules = 1;
}

message CreateRuleRequest {
  string organization_id = 1;
  string name = 2;
  string description = 3;
  string condition = 4;
  double multiplier = 5;
  int32 priority = 6;
}

message CreateRuleResponse {
  PricingRule rule = 1;
}

message UpdateRuleRequest {
  string id = 1;
  string name = 2;
  string description = 3;
  string condition = 4;
  double multiplier = 5;
  int32 priority = 6;
  bool is_active = 7;
}

message UpdateRuleResponse {
  PricingRule rule = 1;
}

message DeleteRuleRequest {
  string id = 1;
}

message DeleteRuleResponse {
  bool success = 1;
}
